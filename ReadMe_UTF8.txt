SGW ver 1.60
http://javasgw.blogspot.jp/

●はじめに
学校向けのグループウエアです。最低限必要な機能のみに絞ったシンプルレイアウトですが、独自の機能も取り入れています。
・使用言語等　Java Tomcat7 Mysql
　jqueryを利用することで、なるべくajaxの機能も取り入れるようにしています。
・主な機能
　　１０日間の予定表示、お知らせ（掲示板）、メールチェック、メールによる配信、回覧、授業変更、予定表、共有リンク、マイロゴ等
・特徴　～エクセルとの連携～
　エクセルの月毎（シート）の予定表を読み込んで、予定表示するようにしています。したがって、グループウエア表示のために、予定を書き込む必要がありません。普段使っている予定表（学校現場ではエクセルが多い）をそのまま、共有フォルダに置いておくだけでデータを読み取ってくれます。
　なお、予定表の各項目の入力は、さらに別のエクセルデータに分散させ、それらをひとつの予定表に統合させるツールも用意していますので、予定表の入力の手間を複数の職員で分散化させることも可能です。
　また、授業変更についても、エクセルに入力したものと同期させるツールを用意しています。（こちらは、エクセルの形式が学校毎異なるため或程度カスタマイズ必要かと思うので、アップロードしていませんが、興味ある方はVb.netのソースやエクセルデータをお渡しできますので、お問い合わせください。hg6141@excite.co.jp）
・Mysqlのレプリケーションにも対応させていますので、複数台のサーバ運用も可能です。
・NotifySgw（VB.net）というソフトをクライアントPCにインストールしておけば、一定時間毎に、新規の回覧メッセージやメールのチェックを行い、新規のものがあれば、ポップアップ表示できます。

・元のソースの著作権がhg6141@excite.co.jpにあることを明示することを条件に、カスタマイズ、改良、配布はフリーソフトとしてであれば自由にしていただいてけっこうです。その際は、一言連絡お願いします。JAVAの初心者のためDRY原則から、はずれているソースですのでご了承ください。

●対象OS、ブラウザ
・Windows7 32bit/64bit、Windows10、WindowsServer2012、Ubuntu等で動作確認しています。
・IE11（互換性表示のチェックははずします）、Edge等で動作確認しています。


●設定について
・Windows用、Ubuntu用の２種類のセットアップファイルを用意したので、それぞれのセットアップマニュアルを見ていただければ、セットアップ可能です。
・万が一、うまく動作しない場合は、以下のQ＆Aを参考にしていただければと思います。

Q1：最初のログインがうまくいかない。
A：Mysql（データベース）にうまくアクセスできてない可能性があります。以下のようにweb.xmlに、MYSQLのHostname,ユーザーIDとパスワードを設定する必要があります。
<context-param>
           <param-name>hostname</param-name>
           <param-value>localhost</param-value>
</context-param>
<context-param>
           <param-name>mysqluser</param-name>
           <param-value>root</param-value>
</context-param>
<context-param>
           <param-name>mysqlpass</param-name>
           <param-value>pass</param-value>
</context-param>

Q2：添付ファイル名が全角だと文字化けがあったり、添付ファイルのダウンロードができない。
Mysql関連の設定では、Windowsの場合、my.ini　Ubuntuの場合/etc/mysql/my.cnf の設定ファイルを確認します。
[client]
default-character-set=utf8　 
[mysqld]
character-set-server=utf8
[mysql]
default-character-set=utf8
srver.xmlに以下のようにConnectorの要素に　URIEncoding="UTF-8"を追加なっているか確認します。
  <Connector port="8080" protocol="HTTP/1.1"　 connectionTimeout="20000"  redirectPort="8443" URIEncoding="UTF-8" />

Q3:添付ファイルの保存場所をディフォルトから変更したい
プログラム内で、Webルートに一時的に添付ファイルを保存してから、同名ファイルチェックを行い、もし同名ファイルがあれば、ファイル名に(1)、(2)という番号を付加してから、指定したフォルダに移動する仕組みになっているため少し複雑な設定になってしまいました。
 
<例１　Linuxサーバ内におく場合>
Catalina/localhostに　tenpu.xmlというファイルを作成.中身はたとえば以下のとおりです。（または、server.xmlにも記述できるようですが）
<?xml version="1.0" encoding="UTF-8"?>
<Context path="/tenpu" docBase="/media/kyoyu/tenpu" antiResourceLocking="false" privileged="true" />
この場合は、SGWでの設定では、/media/kyoyu/tenpu/（サーバから見た場所）　　../tenpu/(userから見た場所）　のようにする。
<例２　Windows共有サーバに置く場合>
HomeICT.xmlの中身
<Context path="/HomeICT" reloadable="true" docBase="\\192.168.1.1\HomeICT"　workDir="D:\apache-tomcat-7.0.28\webapps\SGW\work" />
この場合は、SGWでの設定では　\\\\192.168.1.1\\HomeICT\\（サーバから見た場所）../HomeICT/(userから見た場所）
 
Q4:予定表が使えるようにしたい
予定表は、たとえばLinuxサーバ内であれば　/media/kyoyu/tenpu/yotei.xlsx
共有サーバであれば\\\\192.168.1.1\\HomeICT\\yotei.xlsxなどともできる。

予定表の項目名は、SGWの設定で　,,,,,,,,[全体],[公車],,,,,,,,,,,,[出張],,,,,,,,,,,のような入力欄があるので、ここで設定できる。
カンマがエクセルデータの列数より少ないとエラーが出る可能性あるので、最後のほうに余裕を持たせて、カンマを少し多めに入れておいてください。
[]の項目名がないところは、たとえデータがあっても、表示しないようにしています。
予定表の形式については　A列に日付、B列に曜日となっている必要がある。曜日がない場合は、曜日をプログラム内で計算するようにしている。


Q5　予定表が表示ならない
エクセルはすぐに表示なるか（マクロがあったり、リンクがうまく更新できなかったりしてないか）。

Q6  最初のログイン画面がエラーでうまく表示されない
・サーバー名:8080からtomcat管理画面が表示なるか確認する。
ならないときは、tomcatが起動なっているか確認(Windowsの場合コントロールパネルのサービスで確認できる)する。
・サーバー名:8080/SGW/Login　でアクセスしているか確認する。
 
Q7　Windowsで、mylogoが表示されない
Tenpu.xmlの中の設定はC:\kyoyuのような形式にする。
 
●ユーザーマニュアル
・画面内のラベル等にマウスをかざすと使い方が表示されるようにしてあり、なるべくマニュアルを頼らなくてもいいようにしています。

１　ログインについて
「http://サーバ名:8080/SGW/Login」にアクセスします。
　初期設定では、ユーザー名がadmin　パスワードがpassになっています。
　クッキーの保存できるようになっていれば、２回目以後はhttp://サーバ名:8080/SGW/top.jsp
　にアクセスすることで自動的にログインしたことになります。
 
２　TOP画面について
（１）今日の予定、明日以降の予定は、エクセルの予定表を自動的に読み取るようになっています。
　予定表の形式は以下の通りです。添付されているyotei.xlsxを参考にしてみてください。
・各シート名が４月から３月そして最後が4というシートにまでとなっていること。「4」というシートは、３月のときだけ、翌月（次年度の４月）のデータを表示させたいとき使用
　するシートです。４月になったら、「４月」のほうを読み取るようになっています。
・A列が日付、B列が曜日、C列以降は、各項目名になっていること。
　　表示したい項目は
メニューの設定→各種設定→ファイルの保存場所等の画面を開きます。
「予定表エクセルデータから抽出する項目」の欄に設定します。
　　　例。,,[会議等],[行事等],[当番],[備考],,,,,　　(,)は余裕を持って少し多めに入力しておきます。
・予定表エクセルファイルの保存場所は、上記と同じ画面で「予定表エクセルファイルの保存場所およびファイル名」の欄に入力します。
　　　例。/kyoyu8/H26yotei.xlsx（Linuxの場合）　　サーバ内のパスとファイル名で指定します。共有上に置くことも可能です。その場合は「\\\\共有名\\ファイル名」のようにして指定します。
・xls形式も、xlsx形式のいずれにも対応します。
 
（２）　お知らせについて
・「新規」をクリックして、件名、内容を入力します。添付ファイルをつけたいときは、「参照」をクリックしてファイルを選択して下さい。大きなファイルはアップロードに時間がかかるので、「ファイルのアップロード終了！次の操作に移ってもだいじょうぶです」というメッセージが出るまで待って下さい。
・掲載開始日と掲載終了日も指定できます。
・添付ファイルの保存場所は、メニューの設定→各種設定→ファイルの保存場所等を開いて設定します。
　　「添付ファイル保存場所（サーバからみた場所）」と「添付ファイル保存場所（ユーザーからみた場所）」の２カ所で設定する必要があります。
<例１　Linuxサーバ内におく場合>　（詳細は、TOMCATの資料参照）
コンテキストの設定は<Context path="/tenpu"   docBase="/kyoyu/tenpu"　～ />
/kyoyu/tenpu/（サーバから見た場所）　　　../tenpu/(userから見た場所）
　<例２　Windows共有サーバに置く場合>
コンテキストの設定は<Context path="/HomeICT" ～　docBase="\\192.168.1.1\HomeICT" />
\\\\サーバ名\\HomeICT\\（サーバから見た場所）../HomeICT/(userから見た場所）
 
・「編集」「削除」は、メッセージの作成者のみが可能です。
・「非表示設定」は、自分の所属しない部門への連絡を非表示にしたい場合に使います。あらかじめ、件名につけるキーワードを学校内で決めておき（例。「○○部＞　□□のお知らせ」であれば「○○部＞」の部分）そのキーワードが含まれている場合は、そのメッセージを非表示にする機能です。自分が所属しない部門のキーワードをスペース文字で区切って複数設定できます。一度設定したキーワードは保存されます。（注：ただし、キーワードには＃、＊、？、＿、！、％は使えません。）
・「検索」は期間を指定して、検索ボタンを押すことで、過去や先々のメッセージを確認できます。
また、テキスト欄に文字を入力すると、その文字を件名や内容に含むメッセージを検索します。過去に掲載した内容を調べたいときに活用できると思います。
 
（３）回覧について
・「新規登録」をクリックして、件名、内容を入力します。宛先の欄をクリックして、左欄で、全職員か、グループを選択します。それに応じて右欄に職員名が表示されるので、全員を選択したいときは、右上のチェックボックスをチェックします。個別にチェックをすることもできます。
・「編集」「削除」は、メッセージの作成者のみが可能です。
・添付ファイルについては、「お知らせ」と同様の方法でアップロードできます。
　なお、添付ファイルは、すでに同一名のファイルがアップロードされているときは、ファイル名の最後に(1)、(2)という番号が付加されます。
 
（４）月予定について
・右上の欄で、指定した月の予定を確認することもできます。
・エクセルにあるすべての項目が表示されます。
 
（５）授業変更について
・初期設定は、最新２０件表示に設定されていますが、必要に応じて変更できます。
・「新規登録」をクリックして、日付、校時、クラス名、教科等、担当を入力します。
・「今日の予定」に、その日と次の日の授業変更があれば、「授業変更があります」と表示されます。その文字にマウスを重ねると、予定表が表示されます。
 
（６）リンクについて
・学校内で、共有したいリンクがあれば、このページに登録します。
・「新規登録」をクリックして、表示名とURLを入力します。ＵＲＬは、インターネット上のものでも、ローカルネット上のものでもかまいません。
・添付ファイルのフォルダが共有サーバにある場合は、URLに「http://サーバ名:8080/tenpu/H26○○.pdf」のように入力することで、全体からアクセスすることも可能です。
 
（７）設定について
①ログインパスワードの変更
　　自分がログインするときのパスワードを変更することができます。
②メールについて
・メールチェックの設定　　自分のメールアカウント名、パスワード、ｐｏｐ３サーバ名を入力して保存しておくと、「今日の予定」の欄内に、メールが届いている旨のメッセージが表示され、その文字にマウスを重ねると、届いたメールの件名が表示されます。ただし、メールの本文は、メールソフトでないと受信できません。なお、別ソフト「NotifySGW」を使うことで、新着メールがあったことをタスクトレイに表示させることもできます。
・メール配信設定　　この画面の、「配信を希望するメールアドレス」欄に入力したメールアドレスに、お知らせや回覧の内容を添付ファイルを含めて転送します。設定に際しては、セキュリティポリシーに従う必要があります。
「件名の連絡を希望するメールアドレス」欄に入力したメールアドレスには、お知らせや回覧の件名のみ転送します。
 
③職員の設定について
・ID一覧の画面では、「追加」をクリックし、氏名（全角可）、user（半角英数字のみ）を入力し、「送信」のクリックで職員が新規登録されます。
　編集したいときは、編集したい職員の行を選択して、編集が終わったら、Enterキーを押します。
・グループ登録の画面では、「追加」をクリックし、「グループ名」を入力し、メンバーをCtrlキーを押しながら、マウスで選択していきます。確定したら「送信」をクリックし、最後に、Enterキーを押します。　編集の際も、メンバーの選択のときは、Ctrlキーを押しながら行って下さい。そして最後にEnterキーを押します。
 
 